#!/usr/bin/perl

# Copyright 2002-2013, Paul Johnson (paul@pjcj.net)

# This software is free.  It is licensed under the same terms as Perl itself.

# The latest version of this software should be available from my homepage:
# http://www.pjcj.net

require 5.6.1;

use strict;
use warnings;

# VERSION

use lib qw( ./lib );
use Pod::Usage;
use Devel::Cover::DB;
use Devel::Cover::Dumper;
use Devel::Cover::cpancover::Defaults qw(
    %defaults
    get_options
);
use Devel::Cover::cpancover::Template::Provider;
use Devel::Cover::cpancover;

use Getopt::Long;
use Template 2.00;

$|++;

my $Options = get_options(\%defaults);

print "$0 version " . __PACKAGE__->VERSION . "\n" and exit 0
    if $Options->{version};
pod2usage(-exitval => 0, -verbose => 0)  if $Options->{help};
pod2usage(-exitval => 0, -verbose => 2)  if $Options->{info};

my $config = Devel::Cover::cpancover->new($Options);

if ($config->{collect}) {
    $config->run_cover;
}

my $Template = Template->new( {
    LOAD_TEMPLATES =>
    [
        Devel::Cover::cpancover::Template::Provider->new({}),
    ],
} );

$config->write_html($Template);

######### SUBROUTINES ##########

__END__

=head1 NAME

cpancover - report coverage statistics on CPAN modules

=head1 SYNOPSIS

 cpancover -help -info -version

=head1 DESCRIPTION


=head1 OPTIONS

The following command line options are supported:

    -h -help                - show help
    -i -info                - show documentation
    -v -version             - show version
    -collect                - run 'cover' on modules; default is 'on'
    -directory              - directory under which to search for modules
                              needing coverage analysis
    -force                  - force re-rebuild and re-test of module even if
                              'cover' has already been run
    -module                 - ???
    -outputdir              - directory into which overall coverage report
                              will be placed; defaults to value of 'directory'
                              option or current directory
    -outputfile             - name of overall summary file; defaults to
                              'coverage.html'
    -redo_cpancover_html    - defaults to 'off'
    -redo_html              - defaults to 'off'
    -report                 - type of output generated; defaults to
                              'html_basic'

=head1 DETAILS


=head1 REQUIREMENTS

The modules L<Template> and L<Parallel::Iterator> are required.

=head1 EXIT STATUS

The following exit values are returned:

0   All operations were completed successfully.

>0  An error occurred.

=head1 SEE ALSO

 L<Devel::Cover>

=head1 BUGS

=head1 LICENCE

Copyright 2002-2013, Paul Johnson (paul@pjcj.net)

This software is free.  It is licensed under the same terms as Perl itself.

The latest version of this software should be available from my homepage:
http://www.pjcj.net

=cut

__END__
# use Carp; $SIG{__DIE__} = \&Carp::confess;
